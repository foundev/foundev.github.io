---
wordpress_id: 18
title: "Python Web Framework Series â€“ Pylons: Part 5 Testing Models"
date: 2009-07-02T20:09:00+00:00
author: Ryan Svihla
layout: post
dsq_thread_id:
  - "425624229"
tags:
  - python
---
<p>UPDATE: was an error caught by Govind (who is turning out to be my unofficial proofreader). I&#8217;ve made a correction in the thread mapping for &#8220;dateadded&#8221; property in the <em>previous</em> article. If this you are caught up with and <em>error indicating there is no dateadded property on thread</em> make sure to edit your <strong>model__init__.py</strong> file to match the previous article and rebuild your db so that everything is happy. Please bear with me as I hone my tutorial writing skill set.</p>
<p>When we last left of with our Pylons forum we had a had just successfully created a post, and then could immediately retrieve that same post. However, we kind of skimped on the testing story so lets fill in the gaps and do some refactoring as a bonus.</p>
<h3>Functional Testing Models</h3>
<p>Open your functional controller test located at <strong>pylonsforumtestsfunctionaltest_home.py</strong> and add the following import line</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
  <div style="font-family:consolas,lucida console,courier,monospace">
    <span style="color: #008000"><b>from</b></span>&nbsp;<span style="color: #0000ff"><b>pylonsforum.model</b></span>&nbsp;<span style="color: #008000"><b>import</b></span>&nbsp;Thread,&nbsp;Post,&nbsp;meta
  </div>
</div>

<p>and the following methods</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
  <div style="font-family:consolas,lucida console,courier,monospace">
    <span style="color: #008000"><b>def</b></span>&nbsp;<span style="color: #0000ff">setUp</span>(<span style="color: #008000">self</span>):<br /> &nbsp;&nbsp;&nbsp;&nbsp;meta<span style="color: #666666">.</span>Session<span style="color: #666666">.</span>remove()<br /> &nbsp;&nbsp;&nbsp;&nbsp;meta<span style="color: #666666">.</span>metadata<span style="color: #666666">.</span>create_all(meta<span style="color: #666666">.</span>engine)<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000">self</span><span style="color: #666666">.</span>_createpost(<span style="color: #666666">5</span>)</p> 

    <p>
      <span style="color: #008000"><b>def</b></span>&nbsp;<span style="color: #0000ff">_createpost</span>(<span style="color: #008000">self</span>,times):<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;<span style="color: #666666">=</span>&nbsp;<span style="color: #666666"></span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000"><b>while</b></span>&nbsp;i&nbsp;<span style="color: #666666"><</span>&nbsp;times:<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;<span style="color: #666666">=</span>&nbsp;i&nbsp;<span style="color: #666666">+</span><span style="color: #666666">1</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;<span style="color: #666666">=</span>&nbsp;Thread()<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread<span style="color: #666666">.</span>subject&nbsp;<span style="color: #666666">=</span>&nbsp;<span style="color: #ba2121">&#8220;subject&nbsp;&#8220;</span>&nbsp;<span style="color: #666666">+</span>&nbsp;<span style="color: #008000">str</span>(i)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post&nbsp;<span style="color: #666666">=</span>&nbsp;Post()<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post<span style="color: #666666">.</span>author&nbsp;<span style="color: #666666">=</span>&nbsp;<span style="color: #ba2121">&#8220;posting&nbsp;away&#8221;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post<span style="color: #666666">.</span>content<span style="color: #666666">=</span>&nbsp;<span style="color: #ba2121">&#8220;&#8221;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post<span style="color: #666666">.</span>isparent&nbsp;<span style="color: #666666">=</span>&nbsp;<span style="color: #008000">True</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread<span style="color: #666666">.</span>posts<span style="color: #666666">.</span>append(post)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta<span style="color: #666666">.</span>Session<span style="color: #666666">.</span>add(thread)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta<span style="color: #666666">.</span>Session<span style="color: #666666">.</span>commit() </div> </div>

<pre><code>  &lt;p&gt;
    &amp;nbsp;
  &lt;/p&gt;

  &lt;p&gt;
    and change the test_recent_posts method to
  &lt;/p&gt;

  &lt;p&gt;
    &amp;nbsp;
  &lt;/p&gt;

  &lt;div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent"&gt;
    &lt;div style="font-family:consolas,lucida console,courier,monospace"&gt;
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;def&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;test_five_most_recent_threads_show_in_homepage&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;response&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;self&lt;/span&gt;&lt;span style="color: #666666"&gt;.&lt;/span&gt;app&lt;span style="color: #666666"&gt;.&lt;/span&gt;post(url(controller&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #ba2121"&gt;&amp;#8220;home&amp;#8221;&lt;/span&gt;,&amp;nbsp;action&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #ba2121"&gt;&amp;#8220;index&amp;#8221;&lt;/span&gt;))&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;assert&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;subject&amp;nbsp;1&amp;#8221;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #aa22ff"&gt;&lt;b&gt;in&lt;/b&gt;&lt;/span&gt;&amp;nbsp;response&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;assert&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;subject&amp;nbsp;2&amp;#8221;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #aa22ff"&gt;&lt;b&gt;in&lt;/b&gt;&lt;/span&gt;&amp;nbsp;response&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;assert&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;subject&amp;nbsp;3&amp;#8221;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #aa22ff"&gt;&lt;b&gt;in&lt;/b&gt;&lt;/span&gt;&amp;nbsp;response&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;assert&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;subject&amp;nbsp;4&amp;#8221;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #aa22ff"&gt;&lt;b&gt;in&lt;/b&gt;&lt;/span&gt;&amp;nbsp;response&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;assert&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;subject&amp;nbsp;5&amp;#8221;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #aa22ff"&gt;&lt;b&gt;in&lt;/b&gt;&lt;/span&gt;&amp;nbsp;response
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;p&gt;
    &amp;nbsp;
  &lt;/p&gt;

  &lt;p&gt;
    &amp;nbsp;
  &lt;/p&gt;

  &lt;p&gt;
    In summary here we&amp;rsquo;re adding a _createpost factory method that generates some basic test threads and parent posts. running &lt;i&gt;nosetests &amp;ndash;-with-pylons=test.ini &lt;/i&gt;should result in failed tests.
  &lt;/p&gt;

  &lt;h3&gt;
    Changing The View and Controller
  &lt;/h3&gt;

  &lt;p&gt;
    Now adjust your &lt;b&gt;index.mako &lt;/b&gt;view to the following:
  &lt;/p&gt;

  &lt;div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent"&gt;
    &lt;div style="font-family:consolas,lucida console,courier,monospace"&gt;
      &lt;span style="color: #bc7a00"&gt;&lt;%&lt;/span&gt;&lt;span style="color: #008000"&gt;def&lt;/span&gt;&amp;nbsp;&lt;span style="color: #7d9029"&gt;name=&lt;/span&gt;&lt;span style="color: #ba2121"&gt;&amp;#8220;title()&amp;#8221;&lt;/span&gt;&lt;span style="color: #bc7a00"&gt;&gt;&lt;/span&gt;Pylons&amp;nbsp;Forum&lt;span style="color: #bc7a00"&gt;&lt;!--%&lt;/span--&gt;&lt;span style="color: #008000"&gt;def&lt;/span&gt;&lt;span style="color: #bc7a00"&gt;&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #bc7a00"&gt;&lt;%&lt;/span&gt;&lt;span style="color: #008000"&gt;def&lt;/span&gt;&amp;nbsp;&lt;span style="color: #7d9029"&gt;name=&lt;/span&gt;&lt;span style="color: #ba2121"&gt;&amp;#8220;head_tags()&amp;#8221;&lt;/span&gt;&lt;span style="color: #bc7a00"&gt;&gt;&lt;!--%&lt;/span--&gt;&lt;span style="color: #008000"&gt;def&lt;/span&gt;&lt;span style="color: #bc7a00"&gt;&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #008000"&gt;&lt;b&gt;&lt;div&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #7d9029"&gt;id=&lt;/span&gt;&lt;span style="color: #ba2121"&gt;&amp;#8220;recentposts&amp;#8221;&lt;/span&gt;&lt;span style="color: #008000"&gt;&lt;b&gt;&gt;&lt;/b&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #008000"&gt;&lt;b&gt;&lt;table&gt;&lt;/b&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #008000"&gt;&lt;b&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/b&gt;&lt;/span&gt;subject&lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/th&gt;&lt;th&gt;&lt;/b&gt;&lt;/span&gt;author&lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/th&gt;&lt;th&gt;&lt;/b&gt;&lt;/span&gt;date&amp;nbsp;submitted&lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;/b&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #008000"&gt;&lt;b&gt;&lt;tbody&gt;&lt;/b&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #bc7a00"&gt;%&lt;/span&gt;&lt;span style="color: #008000"&gt;&lt;b&gt;for&lt;/b&gt;&lt;/span&gt;&amp;nbsp;t&amp;nbsp;&lt;span style="color: #aa22ff"&gt;&lt;b&gt;in&lt;/b&gt;&lt;/span&gt;&amp;nbsp;c&lt;span style="color: #666666"&gt;.&lt;/span&gt;threads:&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;&lt;tr&gt;&lt;td&gt;&lt;/b&gt;&lt;/span&gt;&lt;span style="color: #bc7a00"&gt;${&lt;/span&gt;t&lt;span style="color: #666666"&gt;.&lt;/span&gt;subject&lt;span style="color: #bc7a00"&gt;}&lt;/span&gt;&lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/td&gt;&lt;td&gt;&lt;/b&gt;&lt;/span&gt;&lt;span style="color: #bc7a00"&gt;${&lt;/span&gt;t&lt;span style="color: #666666"&gt;.&lt;/span&gt;parentpost&lt;span style="color: #666666"&gt;.&lt;/span&gt;author&lt;span style="color: #bc7a00"&gt;}&lt;/span&gt;&lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/td&gt;&lt;td&gt;&lt;/b&gt;&lt;/span&gt;&lt;span style="color: #bc7a00"&gt;${&lt;/span&gt;t&lt;span style="color: #666666"&gt;.&lt;/span&gt;dateadded&lt;span style="color: #bc7a00"&gt;}&lt;/span&gt;&lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&lt;span style="color: #408080"&gt;&lt;i&gt;&lt;!&amp;#8211;&amp;nbsp;changed&amp;nbsp;posts&amp;nbsp;properties&amp;nbsp;to&amp;nbsp;thread&amp;nbsp;properties&amp;nbsp;and&amp;nbsp;added&amp;nbsp;parentpost&amp;nbsp;&amp;#8211;&gt;&lt;/i&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #bc7a00"&gt;%&lt;/span&gt;&lt;span style="color: #008000"&gt;&lt;b&gt;endfor&lt;/b&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/tbody&gt;&lt;/b&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/table&gt;&lt;/b&gt;&lt;/span&gt;&lt;br /&gt; &lt;span style="color: #008000"&gt;&lt;b&gt;&lt;/div&gt;&lt;/b&gt;&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;p&gt;
    So once you&amp;rsquo;ve changed the to using a &amp;ldquo;threads&amp;rdquo; object, added parentpost (where did that come from? I&amp;rsquo;ll get to that in minute) and changed our properties around we need to change the our &lt;b&gt;home.py &lt;/b&gt;controller index action for our cosmetic changes and to work with our new tests:
  &lt;/p&gt;

  &lt;div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent"&gt;
    &lt;div style="font-family:consolas,lucida console,courier,monospace"&gt;
      &amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;def&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;index&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;c&lt;span style="color: #666666"&gt;.&lt;/span&gt;username&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;rsvihla&amp;#8221;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #408080"&gt;&lt;i&gt;#&amp;nbsp;removing&amp;nbsp;this&amp;nbsp;line&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;c.posts&amp;nbsp;=&amp;nbsp;[Post(&amp;#8220;jkruse&amp;#8221;,&amp;nbsp;&amp;#8220;New&amp;nbsp;Kindle&amp;#8221;,&amp;nbsp;&amp;#8220;06/24/2009&amp;#8221;)]&lt;/i&gt;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;thread_query&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;meta&lt;span style="color: #666666"&gt;.&lt;/span&gt;Session&lt;span style="color: #666666"&gt;.&lt;/span&gt;query(model&lt;span style="color: #666666"&gt;.&lt;/span&gt;Thread)&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;c&lt;span style="color: #666666"&gt;.&lt;/span&gt;threads&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;thread_query&lt;span style="color: #666666"&gt;.&lt;/span&gt;order_by(model&lt;span style="color: #666666"&gt;.&lt;/span&gt;Thread&lt;span style="color: #666666"&gt;.&lt;/span&gt;dateadded&lt;span style="color: #666666"&gt;.&lt;/span&gt;desc())&lt;span style="color: #666666"&gt;.&lt;/span&gt;limit(&lt;span style="color: #666666"&gt;5&lt;/span&gt;)&lt;span style="color: #666666"&gt;.&lt;/span&gt;all()&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;return&lt;/b&gt;&lt;/span&gt;&amp;nbsp;render(&lt;span style="color: #ba2121"&gt;&amp;#8216;index.mako&amp;#8217;&lt;/span&gt;)
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;p&gt;
    So our index action now is querying for the 5 most recent threads and storing in our new c.threads context variable. Lets strip the query down into pieces.
  &lt;/p&gt;

  &lt;div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent"&gt;
    &lt;div style="font-family:consolas,lucida console,courier,monospace"&gt;
      thread_query&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;meta&lt;span style="color: #666666"&gt;.&lt;/span&gt;Session&lt;span style="color: #666666"&gt;.&lt;/span&gt;query(model&lt;span style="color: #666666"&gt;.&lt;/span&gt;Thread)
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;p&gt;
    we&amp;rsquo;re working with SQLAlchemy Session object. We call a Thread Model and then store a Thread query object inside the thread_query variable.&amp;nbsp; Now through the thread_query variable we can get&amp;nbsp; access to the Thread objects stored in the database.
  &lt;/p&gt;

  &lt;div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent"&gt;
    &lt;div style="font-family:consolas,lucida console,courier,monospace"&gt;
      c&lt;span style="color: #666666"&gt;.&lt;/span&gt;threads&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;thread_query&lt;span style="color: #666666"&gt;.&lt;/span&gt;order_by(model&lt;span style="color: #666666"&gt;.&lt;/span&gt;Thread&lt;span style="color: #666666"&gt;.&lt;/span&gt;dateadded&lt;span style="color: #666666"&gt;.&lt;/span&gt;desc())&lt;span style="color: #666666"&gt;.&lt;/span&gt;limit(&lt;span style="color: #666666"&gt;5&lt;/span&gt;)&lt;span style="color: #666666"&gt;.&lt;/span&gt;all()
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;p&gt;
    Here we call &amp;ldquo;order_by&amp;rdquo; on our query object and then pass in the Thread model specifying a descending order of the dateadded property. Next we limit it to 5 rows and then call &amp;ldquo;all()&amp;rdquo; which returns our results in a nice python &amp;ldquo;list&amp;rdquo; object.
  &lt;/p&gt;

  &lt;h3&gt;
    Custom Properties on the Model
  &lt;/h3&gt;

  &lt;p&gt;
    Ok so back a few paragraphs ago in the &lt;b&gt;index.mako&lt;/b&gt; view I stuck in a &amp;ldquo;parentpost&amp;rdquo; property on the thread, and I&amp;rsquo;m quite certain you&amp;rsquo;re wondering how I did that. So I&amp;rsquo;ve created the following class &lt;b&gt;teststest_model.py&lt;/b&gt;
  &lt;/p&gt;

  &lt;div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent"&gt;
    &lt;div style="font-family:consolas,lucida console,courier,monospace"&gt;
      &lt;span style="color: #008000"&gt;&lt;b&gt;from&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;&lt;b&gt;pylonsforum.model&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;import&lt;/b&gt;&lt;/span&gt;&amp;nbsp;Thread,&amp;nbsp;Post,&amp;nbsp;meta&lt;br /&gt; &lt;span style="color: #008000"&gt;&lt;b&gt;from&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;&lt;b&gt;pylonsforum.tests&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;import&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #666666"&gt;*&lt;/span&gt;&lt;/p&gt;

      &lt;p&gt;
        &lt;span style="color: #008000"&gt;&lt;b&gt;class&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;&lt;b&gt;TestThreadParent&lt;/b&gt;&lt;/span&gt;(TestController):
      &lt;/p&gt;

      &lt;p&gt;
        &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;def&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;_makethread&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;,&amp;nbsp;hasparent):&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;thread&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;Thread()&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;thread&lt;span style="color: #666666"&gt;.&lt;/span&gt;subject&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;test&amp;#8221;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;parentpost&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;Post()&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;parentpost&lt;span style="color: #666666"&gt;.&lt;/span&gt;content&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;&amp;#8221;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;parentpost&lt;span style="color: #666666"&gt;.&lt;/span&gt;author&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;first&amp;nbsp;post&amp;#8221;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;parentpost&lt;span style="color: #666666"&gt;.&lt;/span&gt;isparent&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;hasparent&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;childpost&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;Post()&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;childpost&lt;span style="color: #666666"&gt;.&lt;/span&gt;content&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;&amp;#8221;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;childpost&lt;span style="color: #666666"&gt;.&lt;/span&gt;author&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;&amp;#8221;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;childpost&lt;span style="color: #666666"&gt;.&lt;/span&gt;isparent&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;False&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;thread&lt;span style="color: #666666"&gt;.&lt;/span&gt;posts&lt;span style="color: #666666"&gt;.&lt;/span&gt;append(childpost)&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;thread&lt;span style="color: #666666"&gt;.&lt;/span&gt;posts&lt;span style="color: #666666"&gt;.&lt;/span&gt;append(parentpost)&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;return&lt;/b&gt;&lt;/span&gt;&amp;nbsp;thread
      &lt;/p&gt;

      &lt;p&gt;
        &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;def&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;test_should_find_parent_post&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;thread&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;self&lt;/span&gt;&lt;span style="color: #666666"&gt;.&lt;/span&gt;_makethread(&lt;span style="color: #008000"&gt;True&lt;/span&gt;)&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;assert&lt;/b&gt;&lt;/span&gt;&amp;nbsp;thread&lt;span style="color: #666666"&gt;.&lt;/span&gt;parentpost&lt;span style="color: #666666"&gt;.&lt;/span&gt;author&amp;nbsp;&lt;span style="color: #666666"&gt;==&lt;/span&gt;&amp;nbsp;&lt;span style="color: #ba2121"&gt;&amp;#8220;first&amp;nbsp;post&amp;#8221;&lt;/span&gt;
      &lt;/p&gt;

      &lt;p&gt;
        &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;def&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;test_should_not_find_parent_when_none_set&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;thread&amp;nbsp;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;self&lt;/span&gt;&lt;span style="color: #666666"&gt;.&lt;/span&gt;_makethread(&lt;span style="color: #008000"&gt;False&lt;/span&gt;)&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;assert&lt;/b&gt;&lt;/span&gt;&amp;nbsp;thread&lt;span style="color: #666666"&gt;.&lt;/span&gt;parentpost&amp;nbsp;&lt;span style="color: #aa22ff"&gt;&lt;b&gt;is&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;None&lt;/span&gt; &lt;/div&gt; &lt;/div&gt;

        &lt;p&gt;
          Our test has a _makethread factory method (another one of those maybe time for a factory class soon!) which can make a parent post or not depending on its parameter, then two tests documenting its behavior in each situation.
        &lt;/p&gt;

        &lt;p&gt;
          So I&amp;rsquo;ve gone back to our &lt;b&gt;models__init__.py&lt;/b&gt; class and changed the Thread class to look like this:
        &lt;/p&gt;

        &lt;div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent"&gt;
          &lt;div style="font-family:consolas,lucida console,courier,monospace"&gt;
            &lt;span style="color: #008000"&gt;&lt;b&gt;class&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;&lt;b&gt;Thread&lt;/b&gt;&lt;/span&gt;(&lt;span style="color: #008000"&gt;object&lt;/span&gt;):&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #aa22ff"&gt;@property&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;def&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #0000ff"&gt;parentpost&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;for&lt;/b&gt;&lt;/span&gt;&amp;nbsp;p&amp;nbsp;&lt;span style="color: #aa22ff"&gt;&lt;b&gt;in&lt;/b&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;self&lt;/span&gt;&lt;span style="color: #666666"&gt;.&lt;/span&gt;posts:&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;if&lt;/b&gt;&lt;/span&gt;&amp;nbsp;p&lt;span style="color: #666666"&gt;.&lt;/span&gt;isparent&amp;nbsp;&lt;span style="color: #666666"&gt;==&lt;/span&gt;&amp;nbsp;&lt;span style="color: #008000"&gt;True&lt;/span&gt;:&lt;br /&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="color: #008000"&gt;&lt;b&gt;return&lt;/b&gt;&lt;/span&gt;&amp;nbsp;p
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;p&gt;
          &amp;nbsp;
        &lt;/p&gt;

        &lt;p&gt;
          Not the best method however its VERY interesting for static language veterans. We are searching an&lt;span style="text-decoration: underline"&gt; instance variable that we have not even defined&lt;/span&gt;!&amp;nbsp; Remember only our SQLAlchemy mapper even makes mention of a &amp;ldquo;posts&amp;rdquo; variable through our relationship mapping, yet our &amp;ldquo;parentpost&amp;rdquo; property is searching through self.posts.&amp;nbsp; Once it finds a parent post it returns true, this is not perfect and again not the ideal way to enforce a database constraint but for a demo it works fine.
        &lt;/p&gt;

        &lt;p&gt;
          Calling &lt;i&gt;nosetests &amp;ndash;-with-pylons=test.ini&lt;/i&gt; should now give you all passing tests&lt;i&gt;. &lt;/i&gt;Running &lt;i&gt;paster serve &amp;ndash;-reload development.ini&lt;/i&gt; and opening &lt;a href="http://localhost:5000"&gt;http://localhost:5000&lt;/a&gt; , adding a couple of threads and you should have something that looks like this:
        &lt;/p&gt;

        &lt;p&gt;
          &lt;a href="//lostechies.com/ryansvihla/files/2011/03/Picture1_6219E7BC.png"&gt;&lt;img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" alt="Picture 1" src="//lostechies.com/ryansvihla/files/2011/03/Picture1_thumb_71505089.png" width="610" border="0" height="410" /&gt;&lt;/a&gt;
        &lt;/p&gt;

        &lt;h3&gt;
          Summary
        &lt;/h3&gt;

        &lt;p&gt;
          We&amp;rsquo;ve completed a home page now that has some dynamic data, added a custom property on our database class, and addressed functional testing with models.&amp;nbsp;
        &lt;/p&gt;
</code></pre>